<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:telerik="http://schemas.telerik.com/2022/xaml/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ToDoList.MainPage"
             xmlns:viewmodel="clr-namespace:ToDoList.ViewModel"
             x:DataType="viewmodel:MainViewModel"
             xmlns:type="clr-namespace:ToDoList.Data.Models">
    <Grid Padding="10"
          RowSpacing="0"
          ColumnSpacing="10">

        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>


        <Frame Grid.Row="1"
               Background="AliceBlue">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width=".90*" />
                    <ColumnDefinition Width=".10*" />
                </Grid.ColumnDefinitions>

                <Entry Grid.Column="0"
                       Text="{Binding TaskTitle}"
                       Placeholder="Enter Quick Task Here"
                       ClearButtonVisibility="Never"
                       FontSize="20">

                </Entry>
                <ImageButton Source="check_mark.png"
                             WidthRequest="25"
                             HeightRequest="25"
                             Grid.Column="2"
                             IsVisible="True"
                             Command="{Binding AddQuickTaskCommand}" />
            </Grid>
        </Frame>

        <CollectionView Grid.Row="0"
                        Grid.ColumnSpan="2"
                        ItemsSource="{Binding TaskItems}"
                        SelectionMode="None">

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="type:TaskItem">
                    <SwipeView>

                        <!--<Grid Padding="0,5">
                            <Frame>
                                <Frame.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:MainViewModel}}, Path=TapCommand}"
                                                          CommandParameter="{Binding .}" />
                                </Frame.GestureRecognizers>
                                
                                <Label Text="{Binding Title}"
                                       FontSize="24" />
                            </Frame>
                        </Grid>-->

                        <Border Padding="5,0,0,0"
                                Margin="5">
                            <Grid RowSpacing="0"
                                  ColumnSpacing="0"
                                  Margin="-5">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="35" />
                                    <RowDefinition Height="30" />
                                    <RowDefinition Height="30" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="50" />
                                    <ColumnDefinition Width="150" />
                                    <ColumnDefinition Width="70" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <HorizontalStackLayout Grid.Row="0"
                                                       Grid.Column="1"
                                                       Grid.ColumnSpan="2"
                                                       Spacing="5">
                                    <Label Grid.Row="0"
                                           Grid.Column="1"
                                           Grid.ColumnSpan="1"
                                           Margin="15,10,0,0"
                                           HorizontalOptions="StartAndExpand"
                                           VerticalOptions="End"
                                           Text="{Binding Title}"
                                           LineBreakMode="TailTruncation"
                                           FontSize="20"
                                           FontFamily="Inter-Bold"
                                           MaximumWidthRequest="180" />

                                    <!--<Frame Grid.Row="0"
                                           Grid.Column="2"
                                           WidthRequest="30"
                                           VerticalOptions="End"
                                           HorizontalOptions="Start"
                                           HeightRequest="25"
                                           Padding="0"
                                           BackgroundColor="Blue"
                                           IsVisible="{Binding HasAttachment}">
                                        <Image Source="attachment.png"
                                               Aspect="AspectFit"
                                               HeightRequest="50"
                                               WidthRequest="15" />
                                    </Frame>

                                    <Frame Grid.Row="0"
                                           Grid.Column="2"
                                           WidthRequest="30"
                                           VerticalOptions="End"
                                           HorizontalOptions="Start"
                                           HeightRequest="25"
                                           Padding="0"
                                           BackgroundColor="{AppThemeBinding Dark={StaticResource CriticalPriorityColor}, Light={StaticResource DarkGH}}"
                                           IsVisible="{Binding IsPinned}">
                                        <Image Source="pin.png"
                                               Aspect="AspectFit"
                                               HeightRequest="50"
                                               WidthRequest="20" />
                                    </Frame>-->

                                </HorizontalStackLayout>

                                <CheckBox Grid.Row="1"
                                          Grid.Column="4"
                                          Margin="0,0,15,0"
                                          x:Name="SelectedBox"
                                          IsChecked="{Binding IsSelected}"
                                          Scale="{OnPlatform iOS=1.2,Android=1.1}" />

                                <!--<Frame BorderColor="Transparent"
                                       Grid.Column="0"
                                       HasShadow="False"
                                       Grid.RowSpan="5"
                                       Margin="{OnPlatform Android='-10,-10,0,-20', iOS='-10,-10,0,-30'}"
                                       WidthRequest="25"
                                       HorizontalOptions="Start">
                                    --><!--<Frame.Triggers>

                                        <DataTrigger TargetType="Frame"
                                                     Binding="{Binding Priority}"
                                                     Value="High">
                                            <Setter Property="BackgroundColor"
                                                    Value="{DynamicResource HighPriorityColor}" />
                                        </DataTrigger>

                                        <DataTrigger TargetType="Frame"
                                                     Binding="{Binding Priority}"
                                                     Value="Medium">
                                            <Setter Property="BackgroundColor"
                                                    Value="{DynamicResource MediumPriorityColor}" />
                                        </DataTrigger>

                                        <DataTrigger TargetType="Frame"
                                                     Binding="{Binding Priority}"
                                                     Value="Low">
                                            <Setter Property="BackgroundColor"
                                                    Value="{DynamicResource LowPriorityColor}" />
                                        </DataTrigger>

                                        <DataTrigger TargetType="Frame"
                                                     Binding="{Binding Priority}"
                                                     Value="Critical">
                                            <Setter Property="BackgroundColor"
                                                    Value="{DynamicResource CriticalPriorityColor}" />
                                        </DataTrigger>

                                        <DataTrigger TargetType="Frame"
                                                     Binding="{Binding Priority}"
                                                     Value="">
                                            <Setter Property="BackgroundColor"
                                                    Value="Transparent" />
                                        </DataTrigger>
                                    </Frame.Triggers>--><!--
                                </Frame>-->

                                <Label Grid.ColumnSpan="5"
                                       Grid.Row="1"
                                       Grid.Column="1"
                                       HorizontalOptions="StartAndExpand"
                                       LineBreakMode="TailTruncation"
                                       Margin="15,5,0,0"
                                       VerticalOptions="Start"
                                       FontSize="Body"
                                       WidthRequest="250"
                                       HeightRequest="{OnPlatform iOS=20}"
                                       Text="{Binding Notes}"
                                       FontFamily="Inter-Regular" />

                                <Frame Grid.Row="2"
                                       Grid.Column="1"
                                       WidthRequest="130"
                                       Padding="6,0,0,0"
                                       Margin="20,10,15,0"
                                       HeightRequest="25"
                                       BackgroundColor="Transparent"
                                       BorderColor="Gray">
                                    <HorizontalStackLayout>
                                        <Image Source="calendar.png"
                                               Aspect="AspectFit"
                                               MaximumWidthRequest="15"
                                               Margin="0,0,4,0" />
                                        <Label HorizontalOptions="StartAndExpand"
                                               VerticalOptions="Center"
                                               WidthRequest="120"
                                               TextColor="{AppThemeBinding Dark=DarkGray, Light=Black}"
                                               FontFamily="Inter-Regular">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <!--<Span Text="📅 " FontSize="Medium"/>  Emoji-->
                                                    <Span Text="{Binding Date, StringFormat='{0:MMM dd, HH:mm}'}" />
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>
                                    </HorizontalStackLayout>
                                </Frame>
                                <Frame Grid.Row="2"
                                       Grid.Column="{OnPlatform Android=2, iOS=2}"
                                       Grid.ColumnSpan="2"
                                       HorizontalOptions="{OnPlatform Android=Start}"
                                       HeightRequest="25"
                                       Margin="0,10,0,0"
                                       Padding="{OnPlatform Android=3, iOS=5}"
                                       BorderColor="Gray"
                                       BackgroundColor="{AppThemeBinding Dark=Black, Light=White}">
                                    <Frame.Triggers>
                                        <DataTrigger TargetType="Frame"
                                                     Binding="{Binding Done}"
                                                     Value="True">
                                            <Setter Property="WidthRequest"
                                                    Value="80" />
                                            <!--<Setter Property="Margin" Value="0,10,15,0"/>-->
                                        </DataTrigger>

                                        <DataTrigger TargetType="Frame"
                                                     Binding="{Binding Done}"
                                                     Value="False">
                                            <Setter Property="WidthRequest"
                                                    Value="100" />
                                        </DataTrigger>
                                    </Frame.Triggers>
                                    <HorizontalStackLayout>
                                        <Image HeightRequest="20"
                                               Aspect="AspectFit"
                                               x:Name="Doneimg"
                                               Margin="0,0,2,0">
                                            <Image.Triggers>
                                                <DataTrigger TargetType="Image"
                                                             Binding="{Binding Done}"
                                                             Value="True">
                                                    <Setter Property="Source"
                                                            Value="done.png" />
                                                </DataTrigger>
                                                <DataTrigger TargetType="Image"
                                                             Binding="{Binding Done}"
                                                             Value="False">
                                                    <Setter Property="Source"
                                                            Value="notdone.png" />
                                                </DataTrigger>
                                            </Image.Triggers>
                                        </Image>
                                        <Label VerticalTextAlignment="Center"
                                               FontAutoScalingEnabled="False"
                                               FontFamily="Inter-Bold"
                                               TextColor="{AppThemeBinding Dark=White, Light=Black}"
                                               Margin="{OnPlatform Android='0,0,0,0'}">
                                            <Label.Triggers>
                                                <DataTrigger TargetType="Label"
                                                             Binding="{Binding Done}"
                                                             Value="True">
                                                    <Setter Property="Text"
                                                            Value="Done" />
                                                </DataTrigger>
                                                <DataTrigger TargetType="Label"
                                                             Binding="{Binding Done}"
                                                             Value="False">
                                                    <Setter Property="Text"
                                                            Value="Not done" />
                                                </DataTrigger>
                                            </Label.Triggers>
                                        </Label>
                                    </HorizontalStackLayout>
                                </Frame>
                            </Grid>
                        </Border>

                        <SwipeView.RightItems>
                            <SwipeItems>
                                <SwipeItem Text="Delete"
                                           BackgroundColor="Red"
                                           Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:MainViewModel}}, Path=DeleteCommand}"
                                           CommandParameter="{Binding .}" />
                            </SwipeItems>
                        </SwipeView.RightItems>

                    </SwipeView>

                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>

        <ImageButton Grid.Row="0"
                     WidthRequest="50"
                     HeightRequest="50"
                     VerticalOptions="End"
                     HorizontalOptions="End"
                     Margin="0,0,0,20"
                     BackgroundColor="AliceBlue"
                     CornerRadius="50"
                     Source="plus.png"
                     Command="{Binding GoAddTaskPageCommand}" />

    </Grid>
</ContentPage>
